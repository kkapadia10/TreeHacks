import { jsx as _jsx } from "react/jsx-runtime";
import * as React from 'react';
export const AudioContext = React.createContext(undefined);
/**
 * 
 *  A wrapper that tracks the currently playing audio. By using this, we can ensure only 1 audio track is playing at a time.
 *  It also manages the situation where a user tries to play an audio file while another is playing.
 *  This component must appear once — and only once — at the root of an app, as the `AudioCard` component depends on it.
 */
export const AudioContextProvider = (props) => {
    const [playingAudio, setPlayingAudio] = React.useState();
    const previousAudio = React.useRef(playingAudio);
    React.useEffect(() => {
        if (previousAudio.current && previousAudio.current !== playingAudio) {
            previousAudio.current.pause();
            previousAudio.current.onended = null;
        }
        previousAudio.current = playingAudio;
    });
    const stop = React.useCallback(() => {
        if (playingAudio) {
            playingAudio.pause();
            playingAudio.onended = null;
        }
        setPlayingAudio(undefined);
    }, [playingAudio]);
    const play = React.useCallback((audio) => {
        audio.currentTime = 0;
        audio.play().catch(error => {
            audio.play();
        });
        audio.onended = stop;
        setPlayingAudio(audio);
    }, [stop]);
    const value = React.useMemo(() => ({ playingAudio, stop, play }), [playingAudio, stop, play]);
    return _jsx(AudioContext.Provider, { ...props, value: value });
};
