import * as React from 'react';
import { useStableFunction } from '../stable_function/stable_function';
export function useControllableValue({ value: valueProp, defaultValue, onChange: onChangeProp, }) {
    const onChange = useStableFunction(onChangeProp !== null && onChangeProp !== void 0 ? onChangeProp : (() => {}));
    const [valueState, setValueState] = React.useState(defaultValue);
    const prevValueRef = React.useRef(valueProp);
    const wasControlledRef = React.useRef(valueProp !== undefined);
    if (prevValueRef.current !== valueProp) {
        wasControlledRef.current = prevValueRef.current !== undefined;
        prevValueRef.current = valueProp;
    }
    const wasControlled = wasControlledRef.current;
    const isControlled = valueProp !== undefined;
    const value = isControlled || wasControlled ? valueProp : valueState;
    const updateValue = React.useCallback((nextValue) => {
        if (!isControlled) {
            setValueState(nextValue);
        }
        onChange(nextValue);
    }, [isControlled, onChange]);
    return [value, updateValue];
}
